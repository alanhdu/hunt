// Generated by CoffeeScript 1.7.1
var requestUpdate, socket;

socket = io.connect();

socket.on("frame", render);

socket.on("error", (function(err) {
  return window.alert(err);
}));

requestUpdate = function() {
  return socket.emit("request frame", {
    username: window.username
  });
};

$("#play").on("click", (function() {
  window.username = $("#username").val();
  socket.emit('begin', {
    width: 51,
    height: 23,
    username: username
  });
  return setInterval((function() {
    return requestUpdate();
  }), 150);
}));

$(window).keydown((function(evt) {
  var chr, direction, key, type, username;
  if (evt.target.tagName.toLowerCase() === "input") {
    return true;
  }
  key = evt.which;
  chr = String.fromCharCode(key);
  if (evt.shiftKey) {
    type = "turn";
  } else {
    type = "move";
  }
  switch (chr) {
    case 'J':
      direction = 'v';
      break;
    case 'K':
      direction = '^';
      break;
    case 'L':
      direction = '>';
      break;
    case 'H':
      direction = '<';
      break;
    default:
      return true;
  }
  evt.preventDefault();
  if (direction !== void 0) {
    username = window.username;
    return socket.emit(type, {
      direction: direction,
      username: username
    });
  }
}));
