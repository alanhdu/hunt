// Generated by CoffeeScript 1.7.1
(function() {
  var socket;

  socket = io.connect();

  socket.on("frame", render);

  socket.on("error", (function(err) {
    return alert(err);
  }));

  socket.on("update", update);

  $("#play").on("click", (function() {
    if (window.uname === void 0) {
      window.uname = $("#username").val();
      return socket.emit('begin', {
        width: 51,
        height: 23,
        username: window.uname
      });
    } else {
      return alert("Already logged in!");
    }
  }));

  $(window).keydown((function(evt) {
    var chr, direction, fire, key, type;
    if (evt.target.tagName.toLowerCase() === "input" || window.uname === void 0 || evt.ctrlKey) {
      return true;
    }
    key = evt.which;
    chr = String.fromCharCode(key);
    switch (chr) {
      case 'J':
        direction = 'v';
        break;
      case 'K':
        direction = '^';
        break;
      case 'L':
        direction = '>';
        break;
      case 'H':
        direction = '<';
        break;
      case 'F':
        fire = true;
        break;
      default:
        return true;
    }
    evt.preventDefault();
    if (direction !== void 0) {
      if (evt.shiftKey) {
        type = "turn";
      } else {
        type = "move";
      }
      socket.emit(type, {
        direction: direction,
        username: window.uname
      });
    }
    if (fire) {
      return socket.emit("fire", {
        username: window.uname
      });
    }
  }));

}).call(this);
