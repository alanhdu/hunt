// Generated by CoffeeScript 1.7.1
(function() {
  var displayArena, escape, getScoreboard, pad;

  this.update = function(info) {
    var key, _i, _len, _ref;
    document.getElementById("scores").innerHTML = getScoreboard(info["scores"]);
    document.getElementById("arena").innerHTML = displayArena(info["arena"], info["x"], info["y"]);
    _ref = ["health", "ammo", "msg"];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      key = _ref[_i];
      if (key in info) {
        document.getElementById(key).innerHTML = escape(info[key]);
      }
    }
    return null;
  };

  this.clear = function() {
    var key, _i, _len, _ref, _results;
    _ref = ["health", "ammo", "msg", "arena", "scores"];
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      key = _ref[_i];
      _results.push(document.getElementById(key).innerHTML = "");
    }
    return _results;
  };

  displayArena = function(arena, curX, curY) {
    var char, s, str, x, y, _i, _len;
    x = 0;
    y = 0;
    str = "";
    for (_i = 0, _len = arena.length; _i < _len; _i++) {
      char = arena[_i];
      s = (function() {
        switch (char) {
          case '\n':
            return "<br/>";
          case ' ':
            return "&nbsp;";
          case '>':
            return "&gt;";
          case '<':
            return "&lt;";
          case '"':
            return "&quot;";
          case '&':
            return "&amp;";
          default:
            return char;
        }
      })();
      if (x === curX && y === curY) {
        str += "<span id='highlight'>" + s + "</span id='highlight'>";
      } else {
        str += s;
      }
      if (char === '\n') {
        y += 1;
        x = 0;
      } else {
        x += 1;
      }
    }
    return str;
  };

  getScoreboard = function(scores) {
    var key, len, map, stat, statLengths, stats, uname, unameLength, _ref;
    unameLength = "Username".length;
    statLengths = {};
    _ref = scores[window.uname];
    for (key in _ref) {
      stat = _ref[key];
      statLengths[key] = key.length;
    }
    for (uname in scores) {
      stats = scores[uname];
      if (uname.length > unameLength) {
        unameLength = uname.length;
      }
      for (key in stats) {
        stat = stats[key];
        stat = String(stat);
        if (!(key in statLengths) || stat.length > statLengths[key]) {
          statLengths[key] = stat.length;
        }
      }
    }
    map = pad("Username", unameLength) + "|" + ((function() {
      var _results;
      _results = [];
      for (key in statLengths) {
        len = statLengths[key];
        _results.push(pad(key, len));
      }
      return _results;
    })()).join("|");
    map += "\n" + Array(map.length + 1).join("-");
    for (uname in scores) {
      stats = scores[uname];
      uname = pad(uname, unameLength);
      stats = ((function() {
        var _results;
        _results = [];
        for (key in statLengths) {
          len = statLengths[key];
          _results.push(pad(stats[key], len));
        }
        return _results;
      })()).join("|");
      map += "\n" + uname + "|" + stats;
    }
    return escape(map);
  };

  pad = function(str, len) {
    str = String(str);
    str += Array(len - str.length + 1).join(" ");
    return str;
  };

  escape = function(str) {
    return String(str).replace(/[& <>"\n]/g, function(chr) {
      switch (chr) {
        case '\n':
          return "<br/>";
        case ' ':
          return "&nbsp;";
        case '>':
          return "&gt;";
        case '<':
          return "&lt;";
        case '"':
          return "&quot;";
        case '&':
          return "&amp;";
      }
    });
  };

}).call(this);
